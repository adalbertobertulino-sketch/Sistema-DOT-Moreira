<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Sistema DOT Moreira - Dashboard</title>
  <link rel="stylesheet" href="styles.css" />
</head>
<body>
  <header class="topbar">
    <div class="brand">Sistema DOT Moreira — Dashboard</div>
    <div class="top-actions">
      <a class="btn btn-secondary" href="reports.html">Relatórios (PDF)</a>
      <button class="btn btn-danger" onclick="logout()">Sair</button>
    </div>
  </header>

  <main class="container">
    <section class="profile box">
      <h2>Perfil</h2>
      <div class="grid2">
        <div><b>Nome:</b> <span id="pNome">Carregando...</span></div>
        <div><b>Email:</b> <span id="pEmail">Carregando...</span></div>
        <div><b>Role:</b> <span id="pRole">Carregando...</span></div>
        <div><b>School:</b> <span id="pSchool">Carregando...</span></div>
      </div>
      <div class="small" id="debug"></div>
    </section>

    <section class="tabs box">
      <nav class="tabbar">
        <button class="tabbtn active" data-tab="painel">Painel</button>
        <button class="tabbtn" data-tab="turmas">Turmas</button>
        <button class="tabbtn" data-tab="alunos">Alunos</button>
        <button class="tabbtn" data-tab="aulas">Faltas por aula</button>
        <button class="tabbtn" data-tab="notas">Notas</button>
        <button class="tabbtn" data-tab="avisos">Avisos DOT</button>
      </nav>

      <div class="tabcontent" id="painel">
        <h2>Painel</h2>
        <div class="kpis">
          <div class="kpi"><div class="kpi-title">Turmas</div><div class="kpi-val" id="kTurmas">0</div></div>
          <div class="kpi"><div class="kpi-title">Alunos</div><div class="kpi-val" id="kAlunos">0</div></div>
          <div class="kpi"><div class="kpi-title">Avisos</div><div class="kpi-val" id="kAvisos">0</div></div>
        </div>
        <div class="small">Dados em tempo real (Firestore).</div>
      </div>

      <div class="tabcontent hidden" id="turmas">
        <h2>Turmas</h2>
        <div class="adminOnly small warn">Somente admin pode criar/editar turmas.</div>

        <div class="form adminOnly">
          <input id="turmaNome" placeholder="Nome da turma (ex: 1º Ano A)" />
          <input id="turmaAno" placeholder="Ano (ex: 2026)" />
          <button class="btn" onclick="saveTurma()">Salvar turma</button>
        </div>

        <ul id="listaTurmas" class="list"></ul>
      </div>

      <div class="tabcontent hidden" id="alunos">
        <h2>Alunos</h2>
        <div class="adminOnly small warn">Somente admin pode cadastrar alunos.</div>

        <div class="form adminOnly">
          <input id="alunoNome" placeholder="Nome do aluno" />
          <select id="alunoTurma"></select>
          <button class="btn" onclick="saveAluno()">Salvar aluno</button>
        </div>

        <ul id="listaAlunos" class="list"></ul>
      </div>

      <div class="tabcontent hidden" id="aulas">
        <h2>Faltas por Aula</h2>
        <div class="form">
          <select id="aulaTurma"></select>
          <select id="aulaAluno"></select>
          <input id="aulaData" type="date" />
          <input id="aulaFaltas" type="number" placeholder="Faltas (ex: 1)" />
          <button class="btn" onclick="saveFaltaAula()">Salvar</button>
        </div>
        <ul id="listaAulas" class="list"></ul>
      </div>

      <div class="tabcontent hidden" id="notas">
        <h2>Notas</h2>
        <div class="form">
          <select id="notaTurma"></select>
          <select id="notaAluno"></select>
          <select id="notaTipo">
            <option value="AV1">AV1</option>
            <option value="AV2">AV2</option>
            <option value="REC">Recuperação</option>
            <option value="FINAL">Final</option>
          </select>
          <input id="notaValor" type="number" step="0.1" placeholder="Nota (ex: 8.5)" />
          <button class="btn" onclick="saveNota()">Salvar</button>
        </div>
        <ul id="listaNotas" class="list"></ul>
      </div>

      <div class="tabcontent hidden" id="avisos">
        <h2>Avisos DOT</h2>
        <div class="adminOnly small warn">Somente admin pode publicar avisos.</div>

        <div class="form adminOnly">
          <input id="avisoTitulo" placeholder="Título do aviso" />
          <input id="avisoData" type="date" />
          <textarea id="avisoTexto" placeholder="Texto do aviso"></textarea>
          <button class="btn" onclick="saveAviso()">Publicar aviso</button>
        </div>

        <ul id="listaAvisos" class="list"></ul>
      </div>
    </section>
  </main>

  <script type="module" src="./firebase.js"></script>
  <script type="module" src="./auth.js"></script>
  <script type="module" src="./dashboard.js"></script>
</body>
</html>
